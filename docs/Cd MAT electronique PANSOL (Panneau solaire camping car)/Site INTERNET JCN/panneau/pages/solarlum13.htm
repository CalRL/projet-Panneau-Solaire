<html>
<head>
<title>module énergie</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<style>
<!--
h1
	{margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:0cm;
	page-break-after:avoid;
	font-size:16.0pt;
	font-family:Arial;}
 li.MsoNormal
	{margin:0cm;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:Sylfaen;}
h2
	{margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:0cm;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:Arial;
	font-style:italic}
table.MsoTableGrid
	{border:1.0pt solid windowtext;
	font-size:10.0pt;
	font-family:Sylfaen;
	}
-->
</style>
</head>

<body bgcolor="#FFFFFF" text="#000000" background="../../images/fspiral.gif" marginwidth="50" leftmargin="50">
<table width="100%" border=0>
  <tbody> 
  <tr> 
    <td align=middle width="10%"><a name="0" href="../../index.htm"> <img alt="bprecedent.gif (4840 octets)" 
      src="../../images/bsom.gif" border=0 width="90" height="76"></a></td>
    <td align=middle width="51%">
      <div align="center"><font size="5" color="#FF0000"> <img border="0" src="../../images/project.gif" width="32" height="32"> 
        </font> <font size="5" color="#0000FF">Module énergie.</font></div>
    </td>
    <td align=middle width="21%">
      <div align="center"><a href="../accueil.htm"> <img alt="bprecedent.gif (3497 octets)" 
      src="../../images/bprec.gif" 
border=0 width="72" height="82"></a></div>
    </td>
  </tr>
  </tbody>
</table>
<p align="center"><img src="../../images/lignrfin.gif" width="530" height="4"></p>
<div class=Section1> 

	<p class="MsoNormal" style="margin-top:6.0pt">Le module énergie permet, à 
	partir du panneau solaire, de charger la batterie et de fournir l&#8217;énergie 
	nécessaire aux différents modules du système.</p>
	<p class="MsoNormal" style="margin-top:6.0pt">Le module énergie dialogue 
	avec le module de contrôle au travers du bus CAN.</p>
	<p class="MsoNormal" align="center" style="margin-top:6.0pt;text-align:center">
	<img border="0" src="solarlum13_fichiers/image002.jpg" width="321" height="199"></p>
	<p class="MsoNormal" style="margin-top:6.0pt">
	<span style="font-family:&quot;Times New Roman&quot;;
color:black">On donne le schéma structurel de ce module&nbsp;:</span></p>
	<p class="MsoNormal" style="margin-top:6.0pt" align="center">
	<img border="0" src="solarlum13_fichiers/image004.jpg" width="683" height="486"></p>
	<h1 style="margin-top:6.0pt;margin-right:0cm;margin-bottom:0cm;margin-left:
0cm;margin-bottom:.0001pt">Gestion de la carte.</h1>
	<p class="MsoNormal" style="margin-top:6.0pt">
	<span style="font-family:&quot;Times New Roman&quot;;
color:black">Le pilotage de la carte est confié à un microcontrôleur PIC16F876. 
	La programmation in situ du PIC est assurée depuis le connecteur RJ11. Elle 
	utilise les broches RB6 et RB7 du PIC. La broche MCLR permet, en mode 
	programmation d'appliquer la tension de programmation.</span></p>
	<p class="MsoNormal" style="margin-top:6.0pt">
	<span style="font-family:&quot;Times New Roman&quot;;
color:black">L&#8217;horloge du processeur est fournie par la sortie SLK du circuit 
	MCP2510 qui fournit un signal de fréquence 2,5 MHz (la fréquence du quartz 
	divisée par 8). </span></p>
	<div align="center">
		<table class="MsoTableGrid" border="0" cellpadding="0" style="border-collapse: collapse; border-width: 0" id="table1">
			<tr>
				<td width="295" valign="top" style="width:221.4pt;padding:0cm 5.4pt 0cm 5.4pt">
				<p class="MsoNormal" align="center" style="margin-top:6.0pt;text-align:center">
				<img border="0" src="solarlum13_fichiers/image006.jpg" width="210" height="185"></td>
				<td width="398" valign="top" style="width:298.65pt;padding:0cm 5.4pt 0cm 5.4pt">
				<p class="MsoNormal" style="margin-top:6.0pt">
				<span style="font-family:&quot;Times New Roman&quot;;
  color:black">La broche MCLR permet également d'assurer un RESET matériel.
				</span></p>
				<p class="MsoNormal" style="margin-top:6.0pt">
				<span style="font-family:&quot;Times New Roman&quot;;
  color:black">Le superviseur d'alimentation MC34164 est activé en mode normal 
				par la mise en place d'un cavalier sur le connecteur NICD. Il 
				permet de produire un RESET matériel dans le cas ou la tension 
				d'alimentation devient trop faible. </span></p>
				<p class="MsoNormal" style="margin-top:6.0pt">
				<span style="font-family:&quot;Times New Roman&quot;;
  color:black">Lors de la programmation ou la mise au point d'un programme, ce 
				cavalier est à enlevé. Le microcontrôleur fonctionne à une 
				fréquence de 4 MHz obtenue grâce à un quartz.</span></td>
			</tr>
		</table>
	</div>
	<h1>Alimentation du système à partir de la batterie.</h1>
	<p class="MsoNormal" style="margin-top:6.0pt">L&#8217;alimentation de l&#8217;ensemble 
	du système est obtenue depuis la batterie par la tension +Bat. Cette tension 
	est mesurée par le PIC après division avec le signal <i>U/BAT</i>.</p>
	<p class="MsoNormal" style="margin-top:6.0pt">Le courant débité par la 
	batterie est mesuré par le PIC grâce au signal <i>I/BAT</i> obtenu après 
	amplification de la tension délivrée par le capteur LTS-6NP.</p>
	<p class="MsoNormal" style="margin-top:6.0pt">La tension d&#8217;alimentation <i>+Vbat</i> 
	du bus système est égale à la tension <i>+Bat</i>. Mais quand la tension 
	+Bat devient inférieur au seuil de décharge profonde de la batterie, il 
	convient de ne plus alimenter le système. Le comparateur LM358 compare la 
	tension +Bat à une tension de référence et n&#8217;alimente le relais que si <i>
	+Bat</i> est suffisante.</p>
	<p class="MsoNormal" align="center" style="margin-top:6.0pt;text-align:center">
	<img border="0" src="solarlum13_fichiers/image008.jpg" width="564" height="253"></p>
	<p class="MsoNormal" style="margin-top:6.0pt">La tension <i>+Velec</i> du 
	bus système est obtenue grâce à un convertisseur abaisseur à découpage 
	depuis la tension <i>+Vbat</i>.</p>
	<p class="MsoNormal" style="margin-top:6.0pt">En effet, les différents 
	modules comportant des régulateurs linéaires pour fournir la tension de +5V 
	nécessaires, il est intéressant de fournir aux modules une tension de 
	l&#8217;ordre de +8V plutôt que 13V afin de réduire les pertes inhérentes à la 
	régulation linéaire.</p>
	<p class="MsoNormal" align="center" style="margin-top:6.0pt;text-align:center">
	<img border="0" src="solarlum13_fichiers/image010.jpg" width="383" height="141"></p>
	<p class="MsoNormal" align="center" style="margin-top:6.0pt;text-align:center">
	<img border="0" src="solarlum13_fichiers/image012.jpg" width="349" height="225"></p>
	<p class="MsoNormal" style="margin-top:6.0pt">La tension <i>+Velec</i> de 8V 
	permet grâce au régulateur 7805 de fournir la tension de 5V nécessaire aux 
	différents circuits de la carte.</p>
	<p class="MsoNormal" style="margin-top:6.0pt">Une tension de -2,5V 
	nécessaire à la mesure des courants est obtenue par les circuits ICL7660S et 
	TL082.</p>
	<p class="MsoNormal" style="margin-top:6.0pt">La LED indicateur de présence 
	tension peut être désactivée par le cavalier prévu à cet effet afin de 
	diminuer la consommation.</p>
	<p class="MsoNormal" style="margin-top:6.0pt">Un interrupteur S permet de 
	mettre la majorité des circuits de la carte hors tension. Cette interrupteur 
	peut être omis sur certaines versions (on a alors des «&nbsp;straps&nbsp;» et le 
	module et continuellement sous tension).</p>
	<h1>Charge de la batterie depuis le panneau solaire.</h1>
	<p class="MsoNormal">La tension fournie par le panneau solaire est mesurée 
	par le PIC grâce au signal U/PS. La batterie est chargée au travers de la 
	résistance de 0,11 ohms, de la diode faible seuil 1N5821 et du capteur 
	LTS-6NP (impédance interne très faible).</p>
	<p class="MsoNormal">La batterie ne se charge que si la tension délivrée par 
	le panneau est supérieure à celle disponible à ses bornes.</p>
	<p class="MsoNormal" style="margin-top:6.0pt">Le courant débité par le 
	panneau est mesuré par le PIC grâce au signal <i>I/PS</i> obtenu après 
	amplification de la tension délivrée par le capteur LTS-6NP.</p>
	<p class="MsoNormal" align="center" style="text-align:center">
	<img border="0" src="solarlum13_fichiers/image014.jpg" width="683" height="246"></p>
	<p class="MsoNormal">La sortie RA5 du PIC va faire conduire le transistor 
	BDW93C si la tension de la batterie dépasse 13,7V afin de limiter sa charge. 
	Cela ne pose pas de problème de limitation de courant car l&#8217;impédance de 
	sortie du panneau est assez élevée.</p>
	<p class="MsoNormal"><span style="font-family: Wingdings">M</span> 
	Attention, sur la version éducation cette commande est désactivée, afin que 
	l&#8217;on puisse utiliser une alimentation continue en lieu et place du panneau. 
	Il faudra, dans ce cas, s&#8217;assurer que la tension de l&#8217;alimentation reste 
	inférieure à 13,7V afin de préserver la batterie.</p>
	<p class="MsoNormal" style="margin-top:6.0pt"><b>Remarque</b>&nbsp;: Dans les 
	systèmes utilisant un panneau solaire de puissance plus importante, on peut 
	remplacer le circuit de charge de la batterie par le sous-ensemble suivant 
	(le circuit imprimé est prévu également pour cette configuration).</p>
	<p class="MsoNormal" align="center" style="text-align:center">
	<img border="0" src="solarlum13_fichiers/image016.jpg" width="522" height="203"></p>
	<p class="MsoNormal" style="margin-top:6.0pt">Un élévateur de tension 
	produit dans ce cas une tension de sortie +Bat limitée à 13,7V. La tension 
	issue du panneau n&#8217;a pas besoin d&#8217;être supérieure à celle de la batterie 
	pour assurer la charge.</p>
	<h1>Accès au bus CAN.</h1>
	<p class="MsoNormal" style="margin-bottom:6.0pt">Pour l&#8217;accès au bus CAN, on 
	utilise les éléments suivants&nbsp;:</p>
	<p class="MsoNormal" align="center" style="margin-bottom:6.0pt;text-align:center">
	<img border="0" src="solarlum13_fichiers/image018.jpg" width="588" height="167"></p>
	<p class="MsoNormal" style="margin-bottom:6.0pt">Le circuit MCP2510 dialogue 
	avec le microprocesseur de la carte à travers les liaisons suivantes&nbsp;:</p>
	<ul style="margin-top: 0cm; margin-bottom: 0cm" type="disc">
		<li class="MsoNormal" style="margin-bottom: 6.0pt">Un bus série 
		constitué de MSO, MSI et l&#8217;horloge MSCK.</li>
		<li class="MsoNormal" style="margin-bottom: 6.0pt">Un fils de sélection 
		de boîtier MCS.</li>
		<li class="MsoNormal" style="margin-bottom: 6.0pt">La sortie MINT peut 
		être utilisé pour générer des interruptions pour le microprocesseur (non 
		activé dans notre cas).</li>
	</ul>
	<p class="MsoNormal" style="margin-bottom:6.0pt">La liaison du circuit 
	MCP2510 avec le bus CAN s&#8217;effectue grâce aux broches TXCAN et RXCAN (niveau 
	TTL) et le circuit d&#8217;interface PCA82C250T qui produit les signaux du bus. Le 
	bus utilise les signaux VCAN+, VCAN- et GND.</p>
	<p class="MsoNormal" style="margin-bottom:6.0pt">Le circuit MCP2510 
	nécessite pour rythmer les signaux du bus CAN d&#8217;un quartz fixé ici à 20 MHz. 
	La broche CLKOUT produit un signal de 2,5 MHz (division par 8 de la 
	fréquence du quartz) qui est utilisé pour fournir une horloge au circuit 
	PIC.</p>
	<p class="MsoNormal">On notera la présence de la résistance RT de 120 ohms 
	qui permet d&#8217;assurer, si nécessaire, la terminaison du bus CAN si l&#8217;on met 
	en place le cavalier prévu.</p>
	<p class="MsoNormal">La LED «&nbsp;TRAFFIC CAN&nbsp;» sera commandé par le PIC pour 
	signaler une activité sur le bus CAN.</p>
	<h1 style="margin-top:6.0pt;margin-right:0cm;margin-bottom:0cm;margin-left:
0cm;margin-bottom:.0001pt">Etude du logiciel embarqué dans le PIC.</h1>
	<p class="MsoNormal" style="margin-top:6.0pt">En ce qui concerne le 
	logiciel, on trouve tout d&#8217;abord les indications relatives à la compilation 
	du programme pour le PIC. La conversion s&#8217;effectue sur 10 bits.</p>
	<p class="MsoNormal" style="margin-top:6.0pt">
	<img border="0" src="solarlum13_fichiers/image020.jpg" width="551" height="86"></p>
	<h2>Gestion du bus CAN.</h2>
	<p class="MsoNormal" style="margin-top:6.0pt">Le driver logiciel du circuit 
	MCP2510 est pris en compte par la ligne&nbsp;:<br>
	<img border="0" src="solarlum13_fichiers/image022.jpg" width="611" height="15"></p>
	<p class="MsoNormal" style="margin-top:6.0pt">L&#8217;identifiant utilisé pour ce 
	module est déclaré&nbsp;:<br>
	<img border="0" src="solarlum13_fichiers/image024.jpg" width="576" height="48"></p>
	<p class="MsoNormal" style="margin-top:6.0pt">La commande de la LED 
	d&#8217;activité est également déclarée&nbsp;:<br>
	<img border="0" src="solarlum13_fichiers/image026.jpg" width="270" height="36"></p>
	<p class="MsoNormal" style="margin-bottom:6.0pt">Le bus CAN n&#8217;est utilisé 
	qu&#8217;en réception par la fonction <i>gest_can</i>&nbsp;. </p>
	<p class="MsoNormal" style="margin-bottom:6.0pt">La réception est opérée par 
	scrutation au moyen de la commande
	<img border="0" src="solarlum13_fichiers/image028.jpg" width="122" height="13">&nbsp;</p>
	<p class="MsoNormal" style="margin-bottom:6.0pt">Si une réception est 
	détectée, on examine l&#8217;identifiant et si c&#8217;est<i> i_rmain</i>, on envoie les 
	données adéquates&nbsp;au module de contrôle avec l&#8217;identifiant <i>i_ren</i>. </p>
	<p class="MsoNormal" style="margin-bottom:6.0pt">La fonction <i>can_putd</i> 
	permet de renvoyer les mesures demandées.</p>
	<p class="MsoNormal" style="margin-bottom:6.0pt">La fonction <i>gest_can</i> 
	est appelée périodiquement par le programme principal.</p>
	<p class="MsoNormal" style="margin-top:6.0pt">
	<img border="0" src="solarlum13_fichiers/image030.jpg" width="588" height="209"></p>
	<h2>Gestion de la charge.</h2>
	<div align="center">
		<table class="MsoTableGrid" border="0" cellpadding="0" style="border-collapse: collapse; border-width: 0" id="table2">
			<tr>
				<td width="343" valign="top" style="width:257.4pt;padding:0cm 5.4pt 0cm 5.4pt">
				<p class="MsoNormal" style="margin-top:6.0pt">La gestion de la 
				charge est assurée par la fonction <i>gest_bat</i>&nbsp; appelée 
				cycliquement depuis le programme principal.</p>
				<p class="MsoNormal" style="margin-top:6.0pt">On positionne les 
				3 indicateurs, batterie en charge, batterie vide et batterie 
				pleine.</p>
				<p class="MsoNormal" style="margin-top:6.0pt">Si la batterie est 
				chargée, on limite la charge. </td>
				<td width="355" valign="top" style="width:266.45pt;padding:0cm 5.4pt 0cm 5.4pt">
				<p class="MsoNormal" style="margin-top:6.0pt">
				<img border="0" src="solarlum13_fichiers/image032.jpg" width="340" height="151"><!--[if gte mso 9]><![endif]--></td>
			</tr>
		</table>
	</div>
	<h1>Mesure des paramètres.</h1>
	<div align="center">
		<table class="MsoTableGrid" border="0" cellpadding="0" style="border-collapse: collapse; border-width: 0" id="table3">
			<tr>
				<td width="343" valign="top" style="width:257.4pt;padding:0cm 5.4pt 0cm 5.4pt">
				<p class="MsoNormal" style="margin-top:6.0pt">La mesure des 
				courants et des tensions est assurée par la fonction <i>mesure</i>&nbsp; 
				appelée cycliquement depuis le programme principal.</p>
				<p class="MsoNormal" style="margin-top:6.0pt">Cette fonction est 
				activée périodiquement par le <i>timer</i> logiciel grâce à 
				l&#8217;indicateur <i>mes_flag</i>.</p>
				<p class="MsoNormal" style="margin-top:6.0pt">On mesure les 
				grandeurs tensions et courants que l&#8217;on place dans une table au 
				moyen du pointeur j qui varie de 0 à 3. On lance ensuite un 
				calcul de moyenne sur les 4 dernières valeurs pour chaque 
				grandeur mesurée. </p>
				<p class="MsoNormal" style="margin-top:6.0pt">
				<img border="0" src="solarlum13_fichiers/image034.jpg" width="340" height="263"></td>
				<td width="355" valign="top" style="width:266.45pt;padding:0cm 5.4pt 0cm 5.4pt">
				<p class="MsoNormal" style="margin-top:6.0pt">
				<img border="0" src="solarlum13_fichiers/image036.jpg" width="341" height="366"><!--[if gte mso 9]><![endif]--></p>
				<p class="MsoNormal" style="margin-top:6.0pt">C&#8217;est l&#8217;indicateur
				<i>clac_flag</i> qui active la fonction <i>calcul</i>.</td>
			</tr>
		</table>
	</div>
	<h2>Le programme principal.</h2>
	<p class="MsoNormal" style="margin-top:6.0pt">La déclaration des variables&nbsp;:<br>
	<img border="0" src="solarlum13_fichiers/image038.jpg" width="467" height="105"></p>
	<p class="MsoNormal" style="margin-top:6.0pt">
	<img border="0" src="solarlum13_fichiers/image040.jpg" width="396" height="33"></p>
	<p class="MsoNormal" style="margin-top:6.0pt">On déclare les fonctions&nbsp;:<br>
	<img border="0" src="solarlum13_fichiers/image042.jpg" width="240" height="84"></p>
	<p class="MsoNormal" style="margin-top:6.0pt">On déclare les 
	entrées/sorties&nbsp;:<br>
	<img border="0" src="solarlum13_fichiers/image044.jpg" width="245" height="34"></p>
	<p class="MsoNormal" style="margin-top:6.0pt">Reste le programme 
	principal&nbsp;qui appelle le programme d&#8217;initialisation&nbsp;:<br>
	<img border="0" src="solarlum13_fichiers/image046.jpg" width="168" height="156"></p>
	<p class="MsoNormal" style="margin-top:6.0pt">Le programme d&#8217;initialisation 
	initialise le bus CAN, la conversion analogique/numérique et le <i>timer</i>.
	<img border="0" src="solarlum13_fichiers/image048.jpg" width="720" height="93"></p>
	<h2>Gestion du temps.</h2>
	<p class="MsoNormal" style="margin-bottom:6.0pt">Afin de ne pas rendre les 
	fonctions bloquantes, on utilise un <i>timer</i> logiciel appelé par un <i>
	timer</i> matériel initialisé pour générer une interruption toutes les ms.</p>
	<p class="MsoNormal" style="margin-bottom:6.0pt">Les déclarations&nbsp;:<br>
	<img border="0" src="solarlum13_fichiers/image050.jpg" width="477" height="65"></p>
	<p class="MsoNormal" style="margin-bottom:6.0pt">Toutes les millisecondes, 
	la fonction ci-dessous est déclenchée&nbsp;:<br>
	<img border="0" src="solarlum13_fichiers/image052.jpg" width="683" height="87"></p>
	<p class="MsoNormal" style="margin-bottom:6.0pt">L&#8217;indicateur <i>mst</i> 
	sert à déclencher les mesures. Ces dernières sont activées toutes les 500 ms 
	par l&#8217;indicateur <i>mes_flag</i>.</p>
	<p class="MsoNormal" style="margin-bottom:6.0pt">Dés que <i>mst</i> atteint 
	la valeur 500 et on remet <i>mst</i> à 0.</p>

	<p> </div>
</body>
</html>
